 /*! 1 2014-07-30 */

var _config = {color: {allTime: 100,addTime: 0,lvMap: [2, 3, 4, 5, 5, 6, 6, 7, 7, 7, 8, 8, 8, 8, 8, 8, 9]},pic: {isOpen: !1,allTime: 5,addTime: 0,lvMap: [2, 3, 3, 4, 4, 4, 4, 5, 5, 5, 5, 5, 6, 6, 6, 6, 6, 6, 6, 6, 6, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 8]}}; 


!function() {
    var a = $("#box"), b = {lv: $("#room .lv em"),time: $("#room .time"),start: $(".play-btn"),back: $("#dialog .btn-back"),share: $("#dialog .btn-share"),pause: $("#room .btn-pause"),resume: $("#dialog .btn-resume"),dialog: $("#dialog"),d_content: $("#dialog .content"),d_pause: $("#dialog .pause"),d_gameover: $("#dialog .gameover")}, c = {init: function(a, b, c) {
            this.type = a, this.api = API[a], this.config = _config[a], this.reset(), this.parent = c, this.el = b, this.renderUI(), this.inited || this.initEvent(), this.inited = !0, this.start()
        },renderUI: function() {
            var b = 90 == window.orientationorientation || -90 == window.orientation, c = b ? window.innerHeight : window.innerWidth;
            c -= 20, c = Math.min(c, 500), a.width(c).height(c), this.el.show();
			if($(window).height()-c < 130){
				//console.warn($(window).height()-c);
				$("#box").css({"top":"auto"});
			}else{
				$("#box").css({"top":"50px"});
			}
			
        },initEvent: function() {
            var d = "ontouchstart" in document.documentElement ? "touchend" : "click", e = this;
            $(window).resize(function() {
                c.renderUI()
            }), a.on(d, "span", function() {
                var a = $(this).data("type");
                "a" == a && e.nextLv.call(e)
            }), b.pause.on(d, _.bind(this.pause, this)), b.resume.on(d, _.bind(this.resume, this)), b.start.on(d, _.bind(this.start, this)), b.back.on(d, _.bind(this.back, this)), b.share.on(d, _.bind(this.share, this))
        },start: function() {
            this.time > 5 && b.time.removeClass("danger"), b.dialog.hide(), this._pause = !1, this.lv = "undefined" != typeof this.lv ? this.lv + 1 : 0, this.lvMap = this.config.lvMap[this.lv] || _.last(this.config.lvMap), this.renderMap(), this.renderInfo(), this.timer || (this.timer = setInterval(_.bind(this.tick, this), 1e3))
			$("#lotteryContainer").empty();
		},share: function() {
        },resume: function() {
            b.dialog.hide(), this._pause = !1
        },pause: function() {
            this._pause = !0, b.d_content.hide(), b.d_pause.show(), b.dialog.show();
        },tick: function() {
            return this._pause ? void 0 : (this.time--, this.time < 6 && b.time.addClass("danger"), this.time < 0 ? void this.gameOver() : void b.time.text(parseInt(this.time)))
        },renderMap: function() {
            if (!this._pause) {
                var b = this.lvMap * this.lvMap, c = "", d = "lv" + this.lvMap;
                _(b).times(function() {
                    c += "<span></span>"
                }), a.attr("class", d).html(c), this.api.render(this.lvMap, this.lv)
            }
        },renderInfo: function() {
            b.lv.text(this.lv)
        },gameOver: function() {
            try {
                WeixinJSBridge.call("showOptionMenu");
            } catch (c) {
            }
            var d = this.api.getGameOverText(this.lv-1);
            this.lastLv = this.lv, this.lastGameTxt = d.txt, this.lastGamePercent = d.percent;
			/*
             var shareTitle = "我在1分钟内" + (this.lastLv) + "次找到了不同的色块！";
            window.shareData.tTitle=shareTitle;
            btGame.setShare({
                title: shareTitle
            });
			
            if (this.lastLv > 0) {
                var scoreMsg = "你一共" + (this.lastLv) + "次找到了不同的色块，你的24k氪金眼还没瞎吗？快让你的朋友也来试试吧" ;
                window.shareData.tTitle="我在1分钟内" + (this.lastLv) + "次找到了不同的色块！你也来试试！";
                btGame.playScoreMsg(scoreMsg);
            }
			*/
            b.d_content.hide(), b.d_gameover.show().find("h3").html(this.lastGameTxt), a.find("span").fadeOut(1e3, function() {
                b.dialog.fadeIn();
            }), this._pause = !0, this.reset();
			setTimeout(lottery_hje,1300);
        },reset: function() {
            this.time = this.config.allTime, this.lv = -1
        },nextLv: function() {
            this.time += this.config.addTime, b.time.text(parseInt(this.time)), this._pause || this.start()
        },back: function() {
            this._pause = !0, this.el.hide(), b.dialog.hide(), this.parent.render()
        }};
    window.Game = c
}(), function(a) {
    var b = {index: $("#index"),room: $("#room"),loading: $("#loading"),dialog: $("#dialog"),play: $(".play-btn")}, c = {init: function() {
            this.initEvent(), this.loading()
        },loading: function() {
            function a() {
                f++, f == e && c.render()
            }
            function b() {
            }
			if (_config.pic.isOpen)
				for (var d = [], e = d.length, f = 0, g = 0; e > g; g++) {
					var h = new Image;
					h.onload = a, h.src = d[g]
				} else
				c.render();
		}, render: function() {
            b.loading.hide(), b.index.show()
        },initEvent: function() {
            var a = "ontouchstart" in document.documentElement ? "touchstart" : "click", c = this;
            b.play.on(a, function() {
                var a = $(this).data("type") || "color";
                b.index.hide(), setTimeout(Game.init(a, b.room, c),500);
            })
        }};
    c.init(), a.API = {}
}(window), function() {
    var a = $("#box"), b = "span", c = $("#help p"), d = $("#help_color"), e = {lvT: ["大色盲", "小小色狼", "小小色鬼", "小小色魔", "初级色狼", "初级色鬼", "初级色魔", "大色狼", "大色鬼", "大色魔", "变态色狼", "变态色鬼", "超级色魔", "变态色魔", "独孤求色"],render: function(e, f) {
            this.lv = f, c.hide(), d.show();
            var g = _config.color.lvMap[f] || _.last(_config.color.lvMap);
            this.d = 15 * Math.max(9 - g, 1), this.d = f > 20 ? 10 : this.d, this.d = f > 40 ? 8 : this.d, this.d = f > 50 ? 5 : this.d;
            var h = Math.floor(Math.random() * e * e), i = this.getColor(255 - this.d), j = this.getLvColor(i[0]);
            a.find(b).css("background-color", i[1]), a.find(b).eq(h).css("background-color", j[1]).data("type", "a").css({"background":j[1]});
        },getColor: function(a) {
            var b = [Math.round(Math.random() * a), Math.round(Math.random() * a), Math.round(Math.random() * a)], c = "rgb(" + b.join(",") + ")";
            return [b, c]
        },getLvColor: function(a) {
            var b = this.d, c = _.map(a, function(a) {
                return a + b + 10
            }), d = "rgb(" + c.join(",") + ")";
            return [c, d]
        },getGameOverText: function(a) {
            // var b = 15 > a ? 0 : Math.ceil((a - 15) / 5), c = this.lvT[b] || _.last(this.lvT), d = c + "lv" + (a + 1), e = 2 * a;
            // return e = e > 90 ? 90 + .15 * a : e, e = Math.min(e, 100), {txt: d,percent: e}
            //var b = 10 > a ? 0 : Math.ceil((a - 10) / 3), c = this.lvT[b] || _.last(this.lvT), d = c + "<br/>lv" + (a + 1), e = 2 * a;
            //var b = 10 > a ? 0 : Math.ceil((a - 10) / 5), c = this.lvT[b] || _.last(this.lvT), d = c + " " + (a+1) + "分" , e = 2 * a;
        	var b = 10 > a ? 0 : Math.ceil((a - 10) / 5), c = this.lvT[b] || _.last(this.lvT), d = c + "<span style='color:#f00;font-size:12px'><br/>您此次的成绩：" + (a+1) + "分</span>" , e = 2 * a;
        	ajax_score(a+1);
        	return e = e > 60 ? 60 + .1 * a : e, e = Math.min(e, 100), {txt: d,percent: e}
        }};
    API.color = e
}();
